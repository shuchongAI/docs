---
title: "DifyでAPIMartを使用する"
description: "Dify LLMOpsプラットフォームでAPIMart APIサービスを設定して使用する詳細ガイド。このガイドは、DifyでAPIMart APIを設定し、強力なAIアプリケーションを構築するのに役立ちます。"
---



## 準備

始める前に、以下を確認してください：

1. **Difyアカウントの登録済み**  
   [Dify公式サイト](https://dify.ai/)にアクセスしてアカウントを登録し、クラウド版または自己ホスト版を選択

2. **APIMart APIキーの取得済み**  
   [APIMartコンソール](https://apimart.ai/console/token)にログインしてAPIキー（`sk-`で始まる）を取得

<Note>
**ヒント：** APIMartアカウントをお持ちでない場合は、まず[APIMart](https://apimart.ai)で登録してAPIキーを取得してください。
</Note>

## ステップ1：Difyにログインして設定にアクセス

### 1.1 Difyプラットフォームへのアクセス

- **クラウド版：** [https://cloud.dify.ai](https://cloud.dify.ai)にアクセスしてログイン
- **自己ホスト版：** お使いのDifyデプロイメントアドレスにアクセス

<Frame>
  <img src="/images/integrations/dify/main-interface.png" alt="Dify メインインターフェース" />
</Frame>

<caption>*Difyメインインターフェース、アプリケーションリストと作成ボタンが表示されます*</caption>

### 1.2 モデル設定ページへの移動

1. 右上の**アバターアイコン**をクリック
2. **設定**を選択
3. 左メニューで**モデルプロバイダー**を選択

<Frame>
  <img src="/images/integrations/dify/model-provider-menu.png" alt="モデルプロバイダー設定ページ" />
</Frame>

<caption>*左メニューで「モデルプロバイダー」オプションを見つけます*</caption>

<Note>
**注意：** Difyは複数のモデルプロバイダーの設定をサポートしています。APIMartを他のプロバイダーと並行して使用できます。
</Note>

## ステップ2：APIMartモデルプロバイダーの追加

<Note>
**設定方法の説明：** DifyでAPIMartを設定する方法は2つあります：

**方法1（推奨）：** OpenAIプロバイダーのカスタムAPI機能を使用
- OpenAIプロバイダー設定でBase URLを`https://api.apimart.ai/v1`に直接変更
- APIMartのAPIキーを入力
- より高速で簡単な設定

**方法2：** カスタムモデルプロバイダーとして追加（本ガイドの方法）
- より柔軟で、APIMartプロバイダーを個別に管理可能
- 複数のAPIプロバイダーを同時に使用する場合に便利

どちらの方法も機能的には同じです。お好みに応じて選択してください。
</Note>

### 2.1 設定方法の選択

#### 方法1：OpenAIカスタムAPIを使用（推奨）

1. モデルプロバイダーページで**OpenAI**プロバイダーを見つける
2. **設定**ボタンをクリック
3. 設定ページで：
   - **API Key**：APIMart APIキーを入力（`sk-xxxxxxxxxxxx`）
   - **API Base URL**または**Base URL**：`https://api.apimart.ai/v1`を入力
4. **保存**をクリック

<Frame>
  <img src="/images/integrations/dify/openai-custom-api.png" alt="OpenAI カスタムAPI設定" />
</Frame>
<Frame>
  <img src="/images/integrations/dify/openai-custom-setting.png" alt="OpenAI カスタムAPI設定" />
</Frame>
<caption>*OpenAIプロバイダーでAPIMartのAPIキーとBase URLを設定*</caption>

5. 設定完了後、OpenAIプロバイダーページに戻り、**モデルリスト**を表示
6. モデルリストで、使用したいモデルを見つける（例：`gpt-4o`、`gpt-4o-mini`、`chatgpt-4o-latest`など）
7. モデル右側の**スイッチ**をクリックして有効化（青色は有効を示す）

<Frame>
  <img src="/images/integrations/dify/openai-model-list.png" alt="OpenAI モデルリスト" />
</Frame>

<caption>*OpenAIモデルリストで必要なモデルを有効化*</caption>

<Warning>
**重要：** APIMartが実際にサポートしているモデルのみを有効化してください！

DifyのOpenAIモデルリストには多くのモデルが表示されますが、APIMartがサポートしているモデルのみが正常に動作します。サポートされていないモデルを有効化すると、API呼び出しが失敗します。

サポートされているモデルの完全なリストについては、[APIMart APIドキュメント](https://docs.apimart.ai)を参照してください。
</Warning>

<Tip>
**APIMartサポート推奨モデル：**

**GPTシリーズ：**
- `gpt-5` / `gpt-5-chat-latest` - GPT-5シリーズモデル
- `chatgpt-4o-latest` / `gpt-4o` - 最新のGPT-4oモデル
- `gpt-4o-mini` - 高速で経済的なバージョン
- `gpt-4.1` / `gpt-4.1-mini` - GPT-4.1シリーズ

**Claudeシリーズ：**
- `claude-sonnet-4-5-20250929` - Claude Sonnet 4.5
- `claude-haiku-4-5-20251001` - Claude Haiku 4.5

**Geminiシリーズ：**
- `gemini-2.0-flash-exp` - Google Gemini 2.0 Flash

複数のモデルを同時に有効化し、アプリケーションで柔軟に切り替えて使用できます。
</Tip>

完了後、すぐに使用できます。[ステップ3](#ステップ3アプリケーションでapimartモデルを使用)にジャンプしてください。

#### 方法2：カスタムモデルプロバイダーの追加

モデルプロバイダーページで：

1. **カスタムモデル**セクションまでスクロール
2. **+ モデルを追加**ボタンをクリック

<Frame>
  <img src="/images/integrations/dify/custom-model-section.png" alt="カスタムモデルセクション" />
</Frame>

<caption>*カスタムモデルセクションまでスクロールして「+ モデルを追加」ボタンをクリック*</caption>

### 2.2 APIMartプロバイダーの設定

設定ダイアログで、以下の情報を入力：

| フィールド | 値 |
|-----------|---|
| **モデル名称** | `APIMart`またはカスタム名 |
| **モデルタイプ** | `LLM`（大規模言語モデル）を選択 |
| **API Key** | APIMartのAPIキー（`sk-xxxxxxxxxxxx`） |
| **API endpoint URL** | `https://api.apimart.ai/v1` |
| **Endpointモデル名** | 具体的なモデル名を入力（例：`gpt-4o`、`gpt-4o-mini`、`claude-sonnet-4-5-20250929`など） |

<Frame>
  <img src="/images/integrations/dify/add-provider-dialog.png" alt="プロバイダー追加ダイアログ" />
</Frame>

<caption>*APIMartプロバイダー設定情報を入力*</caption>

<Warning>
**重要：**
- Base URLには`/v1`サフィックスを含める必要があります：`https://api.apimart.ai/v1`
- API KeyはAPIMartコンソールから取得した`sk-`で始まるキーである必要があります
- APIキーに十分な残高があることを確認してください
</Warning>

### 2.3 さらにモデルを追加（オプション）

さらにモデルを追加する場合は、上記の手順を繰り返します：

1. カスタムモデルセクションで、**+ モデルを追加**ボタンを再度クリック
2. 別のモデルの設定情報を入力
3. 保存をクリック

**追加推奨モデル：**

#### GPT-4/5シリーズ

| モデルID | モデル名 | コンテキスト長 | 使用例 |
|---------|---------|------------|------|
| `gpt-5` | GPT-5 | 128,000 | 複雑なタスク、長文処理 |
| `gpt-4o` | GPT-4o | 128,000 | 高品質な対話、コード生成 |
| `gpt-4o-mini` | GPT-4o Mini | 128,000 | 高速応答、コスト効率 |

#### Claudeシリーズ

| モデルID | モデル名 | コンテキスト長 | 使用例 |
|---------|---------|------------|------|
| `claude-sonnet-4-5-20250929` | Claude Sonnet 4.5 | 200,000 | 複雑な推論、コード分析 |
| `claude-haiku-4-5-20251001` | Claude Haiku 4.5 | 200,000 | 高速応答、簡単なタスク |

#### Geminiシリーズ

| モデルID | モデル名 | コンテキスト長 | 使用例 |
|---------|---------|------------|------|
| `gemini-2.0-flash-exp` | Gemini 2.0 Flash | 32,000 | マルチモーダル、リアルタイムアプリ |

<Tip>
**パフォーマンス推奨：**
- 💰 **コスト効率：** `gpt-4o-mini`、`claude-haiku-4-5-20251001`
- 🚀 **高性能：** `gpt-5`、`gpt-4o`、`claude-sonnet-4-5-20250929`
- ⚡ **高速応答：** `gemini-2.0-flash-exp`、`gpt-4o-mini`
</Tip>

## ステップ3：アプリケーションでAPIMartモデルを使用

### 3.1 新しいアプリケーションの作成

1. Difyホームページに戻る
2. **アプリを作成**ボタンをクリック
3. アプリケーションタイプを選択：
   - **チャットボット** - 会話型アプリケーション
   - **テキストジェネレーター** - テキスト生成アプリケーション
   - **エージェント** - インテリジェントエージェント
   - **ワークフロー** - 複雑なワークフローアプリケーション

### 3.2 APIMartモデルの選択

アプリケーションオーケストレーションページで：

1. **モデル設定**エリアを見つける
2. **モデルを選択**ドロップダウンをクリック
3. **APIMart**プロバイダーを選択
4. 設定したモデルを選択（例：`gpt-4o`）

### 3.3 モデルパラメーターの設定

必要に応じてモデルパラメーターを調整：

| パラメーター | 説明 | 推奨値 |
|-----------|------|--------|
| **Temperature** | 出力のランダム性を制御 | 0.7（創造的）/ 0.3（正確） |
| **Max Tokens** | 最大出力長 | 2000-4000 |
| **Top P** | ニュークリアスサンプリングパラメーター | 0.9 |
| **Presence Penalty** | 繰り返しを減らす | 0.0-0.5 |
| **Frequency Penalty** | 頻出語を減らす | 0.0-0.5 |

## ステップ4：アプリケーションの構築とテスト

### 4.1 プロンプトの追加

アプリケーションオーケストレーションページで：

1. **システムプロンプト**エリアにプロンプトを記述
2. 変数を使用してアプリを動的にする：
   - `{{variable_name}}` - ユーザー入力変数
   - `{{context}}` - ナレッジベースコンテキスト

**プロンプト例：**

```
あなたはプロフェッショナルなカスタマーサービスアシスタントで、製品に関する質問に答えることが得意です。

製品情報：{{product_info}}

ユーザーの質問に基づいて、正確で親しみやすい回答を提供してください。不明な場合は、正直にユーザーに伝えてください。

ユーザーの質問：{{user_question}}
```

### 4.2 ナレッジベースの追加（オプション）

RAG（検索拡張生成）機能が必要な場合：

1. 左メニューで**ナレッジベース**をクリック
2. 新しいナレッジベースを作成してドキュメントをアップロード
3. アプリケーションオーケストレーションページでナレッジベースをリンク
4. 検索パラメーターを設定

### 4.3 アプリケーションのテスト

1. 右側の**プレビュー**パネルにテスト質問を入力
2. AI応答の効果を確認
3. 必要に応じてプロンプトとパラメーターを調整
4. 満足するまでテストを繰り返す

### 4.4 アプリケーションの公開

テスト後：

1. 右上の**公開**ボタンをクリック
2. 公開方法を選択：
   - **API呼び出し** - APIによる統合
   - **ウェブサイトに埋め込み** - 埋め込みコードを生成
   - **公開リンク** - 共有リンクを生成

## ステップ5：監視と最適化

### 5.1 アプリケーションログの表示

アプリケーション詳細ページで：

1. **ログ**タブをクリック
2. すべての会話記録を表示
3. ユーザーの質問とAI応答を分析
4. 改善の機会を発見

### 5.2 API使用状況の監視

[APIMartコンソール](https://apimart.ai/console)にログインして表示：

- 📊 **API呼び出し統計** - 総呼び出し数、成功率
- 💰 **コスト詳細** - 日次/月次コスト
- 📈 **使用傾向** - 使用量の変化傾向
- 🔍 **リクエストログ** - 詳細なリクエスト記録

### 5.3 アプリケーションパフォーマンスの最適化

監視データに基づいて最適化：

1. **モデル選択の調整**
   - 簡単なタスクには`gpt-4o-mini`を使用してコストを削減
   - 複雑なタスクには`gpt-4o`または`claude-sonnet-4-5`を使用して品質を向上

2. **プロンプトの最適化**
   - プロンプトをより明確で具体的にする
   - 例を追加して効果を向上
   - 思考の連鎖を使用して推論能力を向上

3. **キャッシュの設定**
   - 類似の質問に対してキャッシュを有効化
   - API呼び出しコストを削減

## よくある質問

### Q1: APIMartサービスに接続できない？

**解決策：**

1. **Base URLの確認**：
   - `https://api.apimart.ai/v1`（`/v1`を含む）であることを確認
   - 追加のパスを追加したり、`/v1`を省略したりしない

2. **API Keyの検証**：
   - API Keyが`sk-`で始まることを確認
   - [APIMartコンソール](https://apimart.ai/console/token)でキーが有効か確認

3. **ネットワーク接続の確認**：
   - サーバーが`https://api.apimart.ai`にアクセスできることを確認
   - 自己ホスト版では、サーバーのネットワーク接続を確認

### Q2: モデルの応答が遅い？

**解決策：**

1. **より高速なモデルへの切り替え**：
   - `gpt-4o`の代わりに`gpt-4o-mini`を使用
   - より高速な応答のために`gemini-2.0-flash-exp`を使用

2. **プロンプト長の最適化**：
   - 不要なコンテキストを削減
   - プロンプトの説明を簡略化

3. **ナレッジベース検索の調整**：
   - 検索ドキュメント数を削減
   - 類似度閾値を上げる

### Q3: API呼び出しが失敗またはエラーを返す？

**一般的なエラーと解決策：**

| エラーメッセージ | 原因 | 解決方法 |
|--------------|------|---------|
| `401 Unauthorized` | 無効または期限切れのAPI Key | API Keyを再取得して設定を更新 |
| `429 Too Many Requests` | リクエスト頻度制限超過 | アプリの同時実行設定を調整するか、待機して再試行 |
| `500 Internal Server Error` | 一時的なサーバー障害 | 数分待って再試行 |
| `insufficient_quota` | アカウント残高不足 | コンソールでチャージ |
| `context_length_exceeded` | 入力がコンテキスト長を超過 | 入力長を減らすか、より大きなコンテキストのモデルを使用 |

## サポート＆ヘルプ

問題が発生した場合：

- 📚 [APIMartドキュメント](https://docs.apimart.ai)
- 📚 [Dify公式ドキュメント](https://docs.dify.ai)
- 💬 [Discordコミュニティ](https://discord.gg/V8zqssyZ5c)
- 🐦 [Twitter @APIMart_](https://x.com/APIMart_)
- 📧 技術サポート：zhihong@apimart.ai

---

<Card title="APIMartを始める" icon="rocket" href="https://apimart.ai">
  今すぐAPIMartに登録して、APIキーを取得し、Difyで強力なAIアプリケーションを構築しましょう！
</Card>

